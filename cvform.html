<!DOCTYPE html>
  <html lang="zxx">
    <head>
      <meta charset="utf-8" />
      <meta http-equiv="x-ua-compatible" content="ie=edge" />
      <title>Labour Market Information System</title>
      <meta name="description" content="" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <!-- Place favicon.ico in the root directory -->
      <link
        rel="shortcut icon"
        type="image/x-icon"
        href="assets/img/favicon/Scale Studio.jpg"
      />
      <!-- CSS here -->
      <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
      <link rel="stylesheet" href="assets/css/fontawesome-all.min.css" />
      <link rel="stylesheet" href="assets/css/slick.css" />
      <link rel="stylesheet" href="assets/css/magnific-popup.css" />
      <link rel="stylesheet" href="assets/css/default.css" />
      <link rel="stylesheet" href="assets/css/aos.css" />
      <link rel="stylesheet" href="assets/css/style.css" />


      <style>
       
      </style> 
      
    </head>
    <body>
      <!--  HEADER AREA -->
      <header id="header" class="header-area">
        <div class="container custom-container">
            <nav class="menu-area d-flex align-items-center">
                <div class="logo">
                    <a href="index.html"><img src="assets/img/logo/LMIS 1.png" alt="logo" /></a>
                </div>
                <ul class="main-menu d-flex align-items-center">
                    <li>
                        <a class="active" href="javascript:void(0)">Home</a>
                        
                    </li>
                    <li>
                        <a href="javascript:void(0)">Services</a>
                        <ul class="sub-menu">
                            <li><a href="services.html">Services</a></li>
                            <li>
                                <a href="service-details.html">Services Details</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="javascript:void(0)">About Us</a>
                        <ul class="sub-menu">
                            <li><a href="about-us.html">About Us</a></li>
                            <li><a href="team.html">Team Members</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="javascript:void(0)">Portfolio</a>
                        <ul class="sub-menu">
                            <li><a href="project.html">Project</a></li>
                            <li>
                                <a href="project-details.html">Project Detail</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="contact.html">Contact Us</a>
                       
                    </li>
                    <li><a href="jobseeker.html">Job Seeker</a></li>
                </ul>
                <div class="right-content ml-auto">
                    <div class="search-bar">
                        <img src="assets/img/logo/search.svg" alt="search logo" />
                    </div>
  
              <div class="sign-buttons">
  
                <a
                class="primary__button"
                style="background-color: #925337"
                href="signup.html"
              >
              Post A Job
              </a>
           
                <a
                  class="primary__button"
                  style="background-color: #925337"
                  href="signup.html"
                >
                  Sign Up
                </a>
  
              
              </div>
            </div>
            <div class="hamburger-menu">
              <span></span><span></span><span></span>
            </div>
          </nav>
          <aside>
            <div class="sidebar-menu">
              <div class="close-sidebar"><span></span><span></span></div>
              <div class="logo">
                <a href="index.html">
                  <img src="assets/img/logo/LMIS 1.png" alt="logo" />
                </a>
              </div>
              <form class="asidesearch-bar">
                <input type="text" name="search" />
                <img src="assets/img/logo/search.svg" alt="search logo" />
              </form>
              <ul class="main-menu">
                <li>
                  <a class="active" href="index.html">Home</a>
                </li>
                <li><a href="services.html">About Us</a></li>
                <li><a href="about-us.html">Contact Us</a></li>
                <li><a href="project.html">Services</a></li>
                <li>
                  <a class="primary__button" href="login.html">Login</a>
                </li>
                <li>
                  <a class="primary__button" href="signup.html">Sign Up</a>
                </li>
              </ul>
            </div>
            <div class="overlay"></div>
          </aside>
        </div>
        <div class="search-box">
          <div class="search-form">
            <form action="#">
              <input type="text" placeholder="Enter Your Kayword" />
              <button type="submit">
                <img src="assets/img/logo/search.svg" alt="search logo" />
              </button>
            </form>
          </div>
          <a class="search-close" href="javascript:void(0)"
            ><i class="fas fa-times"></i
          ></a>
        </div>
      </header>
  <body>
    <div class="outer-container">
      <div class="container">
        <h1 style="font-size: 48px;">Add a CV for the employer</h1>
        <br /><br />
        <form id="jobApplicationForm">
          <label for="cvUpload">Upload CV:</label>
          <input
            type="file"
            id="cvUpload"
            name="cvUpload"
            onchange="updateFileName(this)"
            style="display: none"
          />
          <label for="cvUpload" class="upload-label">Select File</label>
          <span id="selectedFileName"></span>

          <label for="applyWithoutCV">Apply without CV:</label>
          <input
            type="checkbox"
            id="applyWithoutCV"
            name="applyWithoutCV"
          /><br /><br /><br />

          <label class="dropdown-label" for="previousEmployee"
            >Have you worked as an employee before?</label
          >
          <select
            id="previousEmployee"
            name="previousEmployee"
            onchange="toggleFields()"
          >
            <option value="no">No</option>
            <option value="yes">Yes</option></select
          ><br /><br />

          <div id="employeeFields">
            <label for="jobTitle">Job Title:</label>
            <input type="text" id="jobTitle" name="jobTitle" /><br /><br />

            <label for="companyName">Company Name:</label>
            <input
              type="text"
              id="companyName"
              name="companyName"
            /><br /><br />

            <label for="experience">Experience:</label>
            <input type="text" id="experience" name="experience" /><br /><br />
          </div>

          <button type="button" onclick="goBack()" class="upload-btn">
            Previous Page
          </button>
          <button type="button" onclick="submitForm()" class="upload-btn">
            Submit
          </button>
        </form>
      </div>
    </div>

    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <p>Form submitted successfulzxcvbnhly!</p>
      </div>
    </div>

    <!-- Add Firebase JavaScript SDK -->
    <!-- Include Firebase scripts using the script tag -->
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>


<script>app.post('/submit-form', async (req, res) => {
  try {
    const formData = req.body;
    if (!formData.first_name || !formData.last_name || !formData.email || !formData.contact_number) {
      return res.status(400).send('Missing required fields');
    }

    // Store form data in Firestore
    await firestore.collection('applicationForm').add(formData);

    // Retrieve list of applicant emails
    const applicantsSnapshot = await firestore.collection('applicationForm').get();
    const applicantEmails = [];
    applicantsSnapshot.forEach(doc => {
      const data = doc.data();
      if (data.email) {
        applicantEmails.push(data.email);
      }
    });

    // Send email notification to each applicant
    // Add your email sending logic here

    res.status(200).send('Form submitted successfully');
  } catch (error) {
    console.error('Error submitting form:', error);
    res.status(500).send('Error submitting form');
  }
});
</script>



<script>


</script>


    <script>
      // Your existing JavaScript code

      // Function to open modal dialog
      function openModal() {
        document.getElementById("myModal").style.display = "block";
      }

      // Function to close modal dialog
      function closeModal() {
        document.getElementById("myModal").style.display = "none";
      }

      // Function to handle form submission
      function submitForm() {
        var cvUploadInput = document.getElementById("cvUpload");
        var file = cvUploadInput.files[0];
        if (file) {
          handleFileUpload(file);
        } else {
          console.error("No file selected");
        }
      }

      // Function to handle file upload
      function handleFileUpload(file) {
        // Your existing file upload logic
        // After successful upload, call openModal() to display the modal dialog
        openModal();
      }
    </script>
    <script>
      // Initialize Firebase with your project config
      const firebaseConfig = {
        apiKey: "AIzaSyBupJ6WVoUv818heRupAiNA4aRT6n--oe0",
        authDomain: "lmis-f3fb0.firebaseapp.com",
        projectId: "lmis-f3fb0",
        storageBucket: "lmis-f3fb0.appspot.com",
        messagingSenderId: "617956268569",
        appId: "1:617956268569:web:2aedaf3162ba98091f2888",
        measurementId: "G-F2N05TD4S3",
      };
      firebase.initializeApp(firebaseConfig);

      // Get references to Firebase Storage and Firestore
      var storage = firebase.storage();
      var firestore = firebase.firestore();

      function updateFileName(input) {
        const fileNameSpan = document.getElementById("selectedFileName");
        if (input.files && input.files.length > 0) {
          fileNameSpan.textContent = input.files[0].name;
        } else {
          fileNameSpan.textContent = "No file selected";
        }
      }

      function toggleFields() {
        var selectBox = document.getElementById("previousEmployee");
        var employeeFields = document.getElementById("employeeFields");

        if (selectBox.value === "yes") {
          employeeFields.style.display = "block";
        } else {
          employeeFields.style.display = "none";
        }
      }

      function goBack() {
        window.location.href = "Applyjobnew.html";
      }

      // Function to handle file upload
      function handleFileUpload(file) {
        var storageRef = storage.ref("cv/" + file.name);
        storageRef
          .put(file)
          .then(function (snapshot) {
            console.log("File uploaded successfully");
            storageRef
              .getDownloadURL()
              .then(function (url) {
                // Store download URL and other form details in Firestore
                var jobApplicationForm =
                  document.getElementById("jobApplicationForm");
                var formData = new FormData(jobApplicationForm);
                formData.delete("cvUpload"); // Exclude cvUpload field
                formData.append("cvUrl", url); // Add CV download URL to form data
                // Save form data to Firestore
                firestore
                  .collection("applications_cv")
                  .add(Object.fromEntries(formData))
                  .then(function (docRef) {
                    console.log("Form data saved with ID: ", docRef.id);
                    // Display success message
                    alert("Form submitted successfully!");
                    // Redirect or show success message
                  })
                  .catch(function (error) {
                    console.error("Error saving form data: ", error);
                  });
              })
              .catch(function (error) {
                console.error("Error getting download URL: ", error);
              });
          })
          .catch(function (error) {
            console.error("Error uploading file: ", error);
          });
      }


      // Function to handle form submission
      function submitForm() {
        var cvUploadInput = document.getElementById("cvUpload");
        var file = cvUploadInput.files[0];
        if (file) {
          handleFileUpload(file);
        } else {
          console.error("No file selected");
        }
      }
    </script>
    <script>document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('applicationForm');
  const formMessage = document.getElementById('formMessage');

  form.addEventListener('submit', function(event) {
    event.preventDefault();

    const formData = new FormData(form);

    fetch('https://us-central1-lmis-f3fb0.cloudfunctions.net/app/submit-form', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      formMessage.textContent = data.message;
      formMessage.classList.remove('hidden');
      form.reset();
    })
    .catch(error => {
      formMessage.textContent = 'An error occurred. Please try again later.';
      formMessage.classList.remove('hidden');
      console.error('Error submitting form:', error);
    });
  });
});
</script>


  </body>
</html>
